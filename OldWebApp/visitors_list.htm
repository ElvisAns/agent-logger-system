<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Agent logger system</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/mdtimepicker.css"> 
  <style type="text/css">
     ::-webkit-scrollbar {
        width: 20px;
      }

      ::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,1); 
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px blue;
        background-color: rgba(18, 43, 63, 0.6); 
      }

  </style>

</head>



<style type="text/css">

@media screen and (min-width: 1200px) {

  html{
    overflow-x: hidden;
  }
  #attendance_table {
      display: block;
  }

  #attendance_table_alert{
    display: none;
  }

  #c4ytable {
      font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
      border-collapse: collapse;
      display: block;
      width: 100%;
      font-size: 11px;
      position: absolute;
      min-height: 30rem;

  }
   
  #c4ytable td, #c4ytable th {
      border: 1px solid #fefefe;
      padding: 25px;
  }
   
  #c4ytable tr:nth-child(even){background-color: #f2f2f2;}
   
  #c4ytable tr:hover {background-color: #ddd;}
   
  #c4ytable th {
      padding-top: 12px;
      padding-bottom: 12px;
      text-align: left;
      background-color: #5B25F5;
      color: white;
  }
}

@media screen and (max-width: 1200px) {

#attendance_table {
      display: none;
  }
  #attendance_table_alert{
    display: block;
  }

}

</style>


<body>
   <nav class="navbar">
    <a class="navbar-brand" href="#">
      <div class="icon-container"> <img src="icons/gem.svg" /> </div> <span class="name">Agent Logger</span> 
    </a>
    <ul class="navbar-nav" >
       <li>
        <a  href="index.htm"><img src="icons/house-fill.svg" /> Home</span> </a>
      </li>
      <li>
        <a href="visitors_list.htm" class="active"> <img src="icons/journal-check.svg" /> Liste des visiteurs</span> </a>
      </li>
      <li>
        <a href="attendance_agents.htm"><span> <img src="icons/journal-check.svg" />Liste de presence</span> </a>
      </li>
      <li>
        <a href="agent_profile.htm"> <span><img src="icons/person-badge.svg" />Profile des employés</span> </a>
      </li>
    </ul>

    <div class="navbar-footer">
      <div class="container">
        <h2>Software Packed by</h2> <span>Elvis Ansima</span> <a href="https://github.com/ElvisAns" target="_blank" >@ElvisAns</a> </div>
    </div>
  </nav>
  <main style="height: auto; border-radius: 0px;">
    <header>
     
      <section role="application">
        </button>
        <button class="notification"> <img class="icon notification" /> </button>
        <button class="menu"> <img class="icon menu" /> </button>
      </section>
    </header>

    <h1>SMART CARD MONITORING</h1>
    <div class="charts-wrapper" id="start_dash">
      <section role="credit-card">
        <div class="top">
          <p id="MyClockDisplay" class="clock" onload="showTime()"></p> <img src="icons/bell-fill.svg" style="
    filter: invert(100%) sepia(10%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);" class="apple_pay" /> </div>
        <div class="ccNumber"> <span>DEVICE ID 8824274290</span> </div>
        <div class="ccBottom">
          <div class="ccValidThru">
            <label>DEVICE STATUS</label> <span>ATTACHED</span> </div>
          <div class="ccCardHolder">
            <label>CLIENT</label> <span>3rd Party</span> </div>
        </div>
      </section>

      <section class="exchange-rates" role="attendee">
        <mainz>
          <div class="cardz"> <img src="icons/person-check-fill.svg">
            <p>AGENTS DEJA PRESENTS</p>
            <p class="attendee_nbr" id="presents">...</p>
            <p>Aujourd'hui</p>
          </div>
          <div class="cardz"> <img src="icons/person-x-fill.svg">
            <p>AGENTS PAS ENCORE PRESENTS</p>
            <p class="attendee_nbr" id="pas_presents">...</p>
            <p>Aujourd'hui</p>
          </div>
          <div class="cardz"> <img src="icons/chevron-double-down.svg">
            <p>VISITEURS</p>
            <p class="attendee_nbr" id="visiteurs">...</p>
            <p>Aujourd'hui</p>
          </div>
        </mainz>
      </section>

      <section role="chart" class="tableAttendance" id="attendance_table" style="border-radius: 0px ;background-color:inherit; margin-top: 30px;  margin-bottom: 30px; width:100%;">
        
        <form style="width: 30%; display: flex; flex-direction: column; font-size: 10px; font-family: Helvetica">
          <input type="text" id="filter" placeholder="Rechercher une valeur specifique">
        </form>

        <TABLE id='c4ytable'>
          <TR>
            <TH>Noms</TH>
            <TH>Mail</TH>
            <TH>Telephone</TH>
            <TH>Profession</TH>
            <TH>ID piece identité</TH>
            <TH>Motif</TH>
            <TH>Personnes à visiter</TH>
            <TH>Heure</TH>
            <TH>Date</TH>
          </TR>
        </TABLE>

      </section>

      <section role="chart" class="exchange-rates" id="attendance_table_alert">
        <h6 style="color:red; display: block; text-align: center; padding-top: 40px;">Votre ecran est petit, veuillez le changer pour visualiser la liste de presence!
          <p>Si vous utiliser un ecran d'ordinateur, vous pouvez essayer de redimensionner cette fenetre</p></h6>
        </h4>
      </section>

     
      <div class="modal-container" id="modal-opened">
        <div class="modal">
          <div class="modal__details">
            <h1 class="modal__title">SMART CARD SCANNED</h1>
            <p class="modal__description" id="status"></p> <img class="modal__description" src="img/avatar.png" style="height: 100px; width: 100px; border-radius:50px; box-shadow: 10px;" id="img" />
            <p class="modal__description"> <span style="font-weight: bolder; font-size: 1.5rem; letter-spacing: 2px;" id="namex"></span>
              <br> <span id="time"></span> </p>
            <p class="modal__description" id="copyright">&copy; 2021, agent-logger by Elvis</p>
          </div>
          <p class="modal__text"></p>
          <button class="modal__btn">consulter la liste&rarr;</button>
          <a href="#modal-closed" class="link-2"></a>
        </div>
      </div>
  </main>
  <!-- partial:index.partial.html -->
  <!--a href="#modal-opened" class="link-1" id="modal-closed">Test du service vantoria attendance</a-->
  <!--a href="https://codepen.io/AbubakerSaeed/full/eYOvKpY" class="second-version-link" target="_blank">CSS Modals (Modal v2)</a><a href="https://abubakersaeed.netlify.app/designs/d7-modal" class="abs-site-link" rel="nofollow noreferrer" target="_blank">abs/designs/d7-modal</a-->
  <!-- partial -->
  <script src='js/Chart.min.js'></script>
  <script src='js/roundedBarCharts.js'></script>
  <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
  <script type="text/javascript" src="js/notify.js"></script>
  <script src="mdtimepicker.js"></script>
  <script type="text/javascript" src="js/jquery.steps.min.js"></script>

  <script type="text/javascript">

  
  $(document).ready(function(){

  $("#filter").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#c4ytable #data").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
  
  setTimeout(function load_visitors(){
  
    if(window.XMLHttpRequest) {
        xmlhttp = new XMLHttpRequest();
      } else {
        xmlhttp = new AcriveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange = function() {
      if(this.readyState == 4 && this.status == 200) { 
      var attendance_table = JSON.parse(this.responseText);
       var x=Object.keys(attendance_table).length; 
       console.log(attendance_table);

       for(x in attendance_table){
        //alert(attendance_table[x]);
        console.log(attendance_table[x]);
            var mail = attendance_table[x].Mail;
            var name = attendance_table[x].Names;
            var _to = attendance_table[x]._to;
            var _heure = attendance_table[x].Heure;
            var _date = attendance_table[x].Date;
            var phone = attendance_table[x].Phone;
            var proff = attendance_table[x].Profession;
            var numeroID = attendance_table[x].ID_piece;
            var motif = attendance_table[x].Motif;
            
          

            var markup = "<tr id=\"data\"> <td>"+name+"</td> <td>"+mail+"</td> <td>"+phone+"</td> <td>"+proff+"</td> <td>"+numeroID+"</td>  <td>"+motif+"</td> <td>"+_to+"</td> <td>"+_heure+"</td> <td>"+_date+"</td> </tr>";
            $("#c4ytable tbody").append(markup);
        
       }
     }
    }

    xmlhttp.open("GET", "backend/load_visitors_list.php", true);
    xmlhttp.send();

  },1000);

});

  $(document).ready(function(){
    $('#timepicker').mdtimepicker(); //Initializes the time picker
  });

  function open_model(h) {
    var url = location.href;
    location.href = "#" + h;
  }

  var data_uix;
  var data_efficience;

  var block_it=0;

  

  setInterval(function monitorComPortData() {
    if(window.XMLHttpRequest) {
      xmlhttp = new XMLHttpRequest();
    } else {
      xmlhttp = new AcriveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
      if(this.readyState == 4 && this.status == 200) {
        
        if(this.responseText.length > 0) {
          
          userData = JSON.parse(this.responseText); //The info of the user and record it in database!
          console.log(userData);
          
          if(userData[0][0].status == "non-change") {
            console.log(userData[0][0].status);



              document.getElementById('presents').innerHTML=userData[1].uixData.attendees;

              document.getElementById('pas_presents').innerHTML= parseInt(userData[1].uixData.agents)-parseInt(userData[1].uixData.attendees);
              
              document.getElementById('visiteurs').innerHTML= userData[1].uixData.visitors;


              if(block_it===0){ //for just loading first chart data
                
                block_it=1111;
                  /*EFFICIENCY CHART This chart will be updated inside the function exeecuted when a card is swipped*/
                var attendee=(parseInt(userData[1].uixData.attendees)/parseInt(userData[1].uixData.agents))*100;
                var missing = 100 - attendee;
                

              }

            

          } 

          else {
            console.log(userData);

                  /*EFFICIENCY CHART This chart will be updated inside the function exeecuted when a card is swipped*/
            var attendee=(parseInt(userData[2].uixData.attendees)/parseInt(userData[2].uixData.agents))*100;
            var missing = 100 - attendee;

              
            location.href = "#" + "modal-opened";
            document.getElementById('namex').innerHTML = userData[1].Names;
            document.getElementById('status').innerHTML = userData[1].status;
            document.getElementById('time').innerHTML = userData[1].Date.toString() + ', ' + userData[1].Time.toString();
            
            try {
              var msg = new SpeechSynthesisUtterance();
              var voices = window.speechSynthesis.getVoices();
              msg.voice = voices[10]; // Note: some voices don't support altering params
              msg.voiceURI = 'native';
              msg.volume = 1; // 0 to 1
              msg.rate = 1.5; // 0.1 to 10
              msg.pitch = 1; //0 to 2
              var temps = userData[1].Time;
              temps = temps.toString();
              heure = temps.substring(0, 2);
              minute = temps.substring(3, 6);
              msg.text = userData[1].Names.toString() + "\r\n Il est :" + heure.toString() + "heures" + minute.toString() + "minutes" + "\r\n" + userData[1].status.toString();
              msg.lang = 'fr-FR';

              speechSynthesis.speak(msg).then(
                location.href = "#" + "modal-closed"
              );

              clearTimeout();
            } catch(e) {
              console.log(userData[0]);
              console.log(e);
            }
          }
        }
      }
    };


    xmlhttp.open("GET", "backend/load_config.php", true);
    xmlhttp.send();
  }, 300);
 



  function showTime() {
    var date = new Date();
    var h = date.getHours(); // 0 - 23
    var m = date.getMinutes(); // 0 - 59
    var s = date.getSeconds(); // 0 - 59
    var session = "AM";
    if(h == 0) {
      h = 12;
    }
    if(h > 12) {
      h = h - 12;
      session = "PM";
    }
    h = (h < 10) ? "0" + h : h;
    m = (m < 10) ? "0" + m : m;
    s = (s < 10) ? "0" + s : s;
    var time = h + ":" + m + ":" + s + " " + session;
    document.getElementById("MyClockDisplay").innerText = time;
    document.getElementById("MyClockDisplay").textContent = time;
    setTimeout(showTime, 1000);
  }
  showTime();
 
  </script>
</body>

</html>